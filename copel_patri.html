<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Copel Patrimonio</title>
    <meta property="og:description" content="Uses the PMTiles plugin and protocol to present a map." />
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@5.16.0/dist/maplibre-gl.css' />
    <script src='https://unpkg.com/maplibre-gl@5.16.0/dist/maplibre-gl.js'></script>
    <script src="https://unpkg.com/pmtiles@3.2.0/dist/pmtiles.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        html, body, #map { height: 100%; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        let protocol = new pmtiles.Protocol();
        maplibregl.addProtocol("pmtiles", protocol.tile);

        // --- PASSO B: Criar o Mapa ---
        const map = new maplibregl.Map({
            container: 'map',
            zoom: 6,
             // Centro do Paran√°
            center: [-51.9292, -24.9926],
            style: {
                version: 8,
                sources: {
                    'osm': {
                        type: 'raster',
                        tiles: ['https://a.tile.openstreetmap.org/{z}/{x}/{y}.png'],
                        tileSize: 256,
                        attribution: '&copy; OpenStreetMap Contributors'
                    },
                    'patri': {
                        type: 'vector',
                        url: 'pmtiles://copel_patri.pmtiles'
                    }
                },
                layers: [
                    {
                        id: 'osm',
                        type: 'raster',
                        source: 'osm',
                    },
                    {
                        id: 'patri_layer',
                        type: 'heatmap',
                        source: 'patri',
                        'source-layer': 'Patrimonio',
                        paint: {
                            "heatmap-weight": [
                                "interpolate",
                                ["linear"],
                                ["coalesce", ["get", "point_count"], 1],
                                0, 0,
                                1, 0.1,
                                500, 1
                            ],
                            // Aumenta a intensidade do heatmap conforme o zoom aumenta
                            "heatmap-intensity": [
                                "interpolate",
                                ["linear"],
                                ["zoom"],
                                0, 1,
                                9, 3
                            ],
                            // Define as cores do gradiente
                            "heatmap-color": [
                                "interpolate",
                                ["linear"],
                                ["heatmap-density"],
                                0, "rgba(33,102,172,0)",
                                0.2, "rgb(103,169,207)",
                                0.4, "rgb(209,229,240)",
                                0.6, "rgb(253,219,199)",
                                0.8, "rgb(239,138,98)",
                                1, "rgb(178,24,43)"
                            ],
                            // Ajusta o raio dos pontos conforme o zoom
                            "heatmap-radius": [
                                "interpolate",
                                ["linear"],
                                ["zoom"],
                                0, 2,
                                9, 20
                            ],
                            "heatmap-opacity": 0.6
                        }
                    }
                ]
            }
        });
    </script>
</body>
</html>